<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Denuncias / Reportes ‚Äì SInOS</title>
<style>
  :root{--bg:#0b1022;--fg:#e6fbff;--edge:rgba(91,215,242,.35);--panel:rgba(7,17,35,.6)}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;background:var(--bg);color:var(--fg)}
  .wrap{max-width:840px;margin:0 auto;padding:16px 14px 24px}
  .card{background:var(--panel);border:1px solid var(--edge);border-radius:16px;padding:16px}
  h1{margin:0 0 8px;font-size:20px}
  p{margin:0 0 12px;opacity:.85}
  form{display:grid;grid-template-columns:1fr;gap:12px;margin-top:8px}
  label{display:grid;gap:6px;font-size:14px}
  input,select,textarea{
    background:rgba(91,215,242,.10); color:var(--fg); border:1px solid rgba(91,215,242,.25);
    border-radius:10px; padding:10px 12px; font-size:14px; outline:none;
  }
  textarea{min-height:140px;resize:vertical}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .btns{display:flex;gap:10px;flex-wrap:wrap}
  .btn{
    background:rgba(91,215,242,.14); color:var(--fg); border:1px solid rgba(91,215,242,.35);
    padding:10px 14px; border-radius:12px; font-size:14px; cursor:pointer
  }
  .muted{font-size:12px;opacity:.7;margin-top:8px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Generar escrito formal</h1>
      <p>Llena los datos para crear un PDF tipo oficio, listo para imprimir o guardar.</p>

      <form id="f">
        <div class="row">
          <label>Nombre del trabajador
            <input name="nombre" required placeholder="Nombre completo">
          </label>
          <label>Matr√≠cula
            <input name="matricula" required placeholder="000000">
          </label>
        </div>

        <div class="row">
          <label>Categor√≠a / Puesto
            <input name="categoria" required placeholder="Ej. T√©c. Radi√≥logo A, Enfermera Gral., etc.">
          </label>
          <label>Secretar√≠a a la que va dirigido
            <select name="secretaria" required>
              <option value="" disabled selected>Selecciona una secretar√≠a</option>
              <option>Secretar√≠a General</option>
              <option>Secretar√≠a del Trabajo</option>
              <option>Secretar√≠a de Conflictos</option>
              <option>Secretar√≠a del Interior y Propaganda</option>
            </select>
          </label>
        </div>

        <label>Describe la problem√°tica
          <textarea name="problematica" required placeholder="Exp√≥n fechas, lugares, personas involucradas (si procede) y qu√© ha ocurrido."></textarea>
        </label>

        <div class="btns">
          <button type="button" class="btn" id="preview">üìù Previsualizar escrito</button>
          <button type="submit" class="btn">üìÑ Generar PDF</button>
          <button type="button" class="btn" id="limpiar">üßΩ Limpiar</button>
        </div>
        <div class="muted">
          Aviso de privacidad: La informaci√≥n es para atenci√≥n sindical. Evita datos sensibles innecesarios. Si requieres anonimato, com√©ntalo en el cuerpo del texto.
        </div>
      </form>
    </div>
  </div>

  <!-- jsPDF desde CDN -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    const $ = (s, r=document)=> r.querySelector(s);
    const fmtFechaMX = (d=new Date()) =>
      d.toLocaleDateString('es-MX', {year:'numeric',month:'long',day:'numeric'});

    function encabezadoSecretaria(sec){
      switch(sec){
        case 'Secretar√≠a General': return 'A la Secretar√≠a General';
        case 'Secretar√≠a del Trabajo': return 'A la Secretar√≠a del Trabajo';
        case 'Secretar√≠a de Conflictos': return 'A la Secretar√≠a de Conflictos';
        case 'Secretar√≠a del Interior y Propaganda': return 'A la Secretar√≠a del Interior y Propaganda';
        default: return 'A quien corresponda';
      }
    }

    function construirCuerpo(datos){
      const {nombre, matricula, categoria, secretaria, problematica} = datos;
      return [
        `${encabezadoSecretaria(secretaria)}`,
        ``,
        `Presente.`,
        ``,
        `Quien suscribe, ${nombre}, con matr√≠cula ${matricula}, de categor√≠a ${categoria}, respetuosamente expongo lo siguiente:`,
        ``,
        `${problematica}`,
        ``,
        `Por lo anterior, solicito atentamente su amable intervenci√≥n para el an√°lisis y pronta atenci√≥n del caso conforme a la normativa aplicable, garantizando el respeto a mis derechos laborales.`,
        ``,
        `Sin otro particular, quedo a sus √≥rdenes para cualquier aclaraci√≥n o ampliaci√≥n de informaci√≥n.`,
        ``,
        `Atentamente,`,
        `${nombre}`,
        `Matr√≠cula ${matricula}`,
        `Categor√≠a ${categoria}`
      ].join('\n');
    }

    function previsualizar(){
      const d = obtenerDatos();
      if(!d) return;
      const lugar = 'Ciudad L√°zaro C√°rdenas, Michoac√°n';
      const fecha = fmtFechaMX();
      const texto = [
        `${lugar}; ${fecha}`,
        ``,
        construirCuerpo(d)
      ].join('\n');
      alert(texto);
    }

    function obtenerDatos(){
      const f = $('#f');
      const nombre = f.nombre.value.trim();
      const matricula = f.matricula.value.trim();
      const categoria = f.categoria.value.trim();
      const secretaria = f.secretaria.value;
      const problematica = f.problematica.value.trim();
      if(!nombre || !matricula || !categoria || !secretaria || !problematica){
        alert('Por favor completa todos los campos requeridos.');
        return null;
      }
      return {nombre, matricula, categoria, secretaria, problematica};
    }

    async function generarPDF(ev){
      ev.preventDefault();
      const d = obtenerDatos();
      if(!d) return;

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({unit:'mm', format:'letter'}); // Carta (MX/US)

      const margen = 18;
      const ancho = doc.internal.pageSize.getWidth();
      const usable = ancho - margen*2;
      let y = 18;

      // Encabezado simple
      doc.setDrawColor(96,165,250);
      doc.setLineWidth(0.6);
      doc.roundedRect(margen, y, usable, 18, 3, 3, 'S');
      doc.setFont('helvetica','bold');
      doc.setFontSize(14);
      doc.text('Escrito formal ‚Äì Innovaci√≥n Sindical', margen+4, y+7.5);
      doc.setFont('helvetica','normal');
      doc.setFontSize(10);
      doc.text('SInOS ‚Äî Sindical Innovation Operative System', margen+4, y+13.5);
      y += 26;

      // Lugar y fecha
      doc.setFontSize(11);
      doc.text('Ciudad L√°zaro C√°rdenas, Michoac√°n; ' + fmtFechaMX(), margen, y);
      y += 8;

      // Destinatario
      doc.setFont('helvetica','bold');
      doc.text(encabezadoSecretaria(d.secretaria), margen, y);
      doc.setFont('helvetica','normal');
      doc.text('Presente.', margen, y+6);
      y += 14;

      // Cuerpo (autowrap)
      doc.setFontSize(12);
      const cuerpo = construirCuerpo(d);
      const lineas = doc.splitTextToSize(cuerpo, usable);
      lineas.forEach(l => {
        if(y > 260){ doc.addPage(); y = 18; }
        doc.text(l, margen, y);
        y += 6;
      });

      // Firma
      y += 10;
      if(y > 240){ doc.addPage(); y = 40; }
      doc.setDrawColor(150, 200, 255);
      doc.line(margen, y, margen+70, y);
      doc.text(d.nombre, margen, y+6);
      doc.text('Firma', margen, y+12);

      // Guardar/Imprimir
      const nombreArchivo = `Escrito_${d.matricula}_${Date.now()}.pdf`;
      doc.save(nombreArchivo);
      // Si prefieres abrir di√°logo de impresi√≥n:
      // window.open(doc.output('bloburl'), '_blank');
    }

    function limpiar(){
      $('#f').reset();
    }

    $('#preview').addEventListener('click', previsualizar);
    $('#f').addEventListener('submit', generarPDF);
    $('#limpiar').addEventListener('click', limpiar);
  </script>
</body>
</html>
