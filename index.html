<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SInOS ‚Äî Sindical Innovation Operative System</title>
  <style>
    :root{
      --c-bg1:#0b1220; --c-bg2:#0b1022; --c-cyan:#5bd7f2; --c-sky:#60a5fa;
      --ring: rgba(91,215,242,.35); --tile: rgba(7,17,35,.6); --tileH: rgba(12,25,55,.7);
      --topbar: 52px; --dock: 60px;
      --boot-ms: 5200ms; /* JS ajusta: 5200ms primera vez, 2200ms despu√©s */
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; overflow:hidden; overscroll-behavior:none; background:#0b1022}
    body{
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; color:#e6fbff;
      background:
        radial-gradient(70vmax 70vmax at 50% 20%, rgba(96,165,250,.15), transparent 60%),
        radial-gradient(60vmax 60vmax at 80% 80%, rgba(91,215,242,.12), transparent 60%),
        linear-gradient(180deg,var(--c-bg1),var(--c-bg2));
    }
    .grid-bg::before{content:"";position:fixed;inset:0;pointer-events:none;opacity:.18;
      background-image:linear-gradient(to right, rgba(96,165,250,.12) 1px, transparent 1px),
                       linear-gradient(to bottom, rgba(91,215,242,.10) 1px, transparent 1px);
      background-size:48px 48px,48px 48px}

    /* Topbar */
    .topbar{position:fixed;inset:0 0 auto 0;height:var(--topbar);display:flex;align-items:center;justify-content:space-between;padding:0 16px;
      background:rgba(9,14,26,.55);backdrop-filter: blur(8px); border-bottom:1px solid rgba(91,215,242,.25); z-index:30}
    .mark{display:grid;place-items:center;width:28px;height:28px;border-radius:10px;background:rgba(91,215,242,.15);border:1px solid var(--ring)}
    .title{display:flex;align-items:center;gap:8px;font-weight:600;color:#bff4ff;letter-spacing:.3px}
    .clock{font-size:12px;color:#a2e7f5}

    /* Capas */
    .layer{position:fixed; left:0; right:0; top:var(--topbar); bottom:var(--dock); overflow:auto; -webkit-overflow-scrolling:touch;}

    /* Home */
    .wrap{padding:24px 20px;max-width:1200px;margin:0 auto}
    .brand{display:flex;gap:16px;align-items:flex-end;justify-content:space-between}
    .brand h1{margin:0;font-size:26px;font-weight:700;color:#d9fbff}
    .brand p{margin:6px 0 0;color:#aee9f7;font-size:14px;max-width:640px}
    .badge{border:1px solid rgba(91,215,242,.25);background:rgba(91,215,242,.12);padding:6px 10px;border-radius:12px;font-size:12px;color:#c7f7ff}

    .tiles{margin-top:18px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
    @media(min-width:640px){.tiles{grid-template-columns:repeat(3,1fr)}}
    @media(min-width:960px){.tiles{grid-template-columns:repeat(4,1fr)}}
    .tile{display:flex;flex-direction:column;justify-content:space-between;min-height:150px;padding:16px;border-radius:16px;
      background:var(--tile); border:1px solid rgba(91,215,242,.22); transition:.18s; cursor:pointer; text-align:left}
    .tile:hover{background:var(--tileH); box-shadow:0 0 0 1px var(--ring) inset, 0 20px 40px rgba(11,18,32,.6)}
    .icon{width:46px;height:46px;border-radius:14px;display:grid;place-items:center;background:rgba(91,215,242,.16); border:1px solid rgba(91,215,242,.3); color:#93eaff}
    .tile h3{margin:0 0 4px;font-size:16px;color:#d8fbff}
    .tile p{margin:0;color:#aee9f7;font-size:12px;opacity:.85}

    /* Dock */
    .dock{position:fixed;inset:auto 0 0 0;height:var(--dock);display:flex;align-items:center; border-top:1px solid rgba(91,215,242,.25);background:rgba(9,14,26,.55);backdrop-filter: blur(8px); z-index:30}
    .dock-inner{max-width:1200px;margin:0 auto;padding:8px 14px;display:flex;gap:10px;justify-content:center;width:100%}
    .dock button{display:inline-flex;align-items:center;gap:8px;border-radius:12px;padding:7px 10px;background:rgba(91,215,242,.14); border:1px solid rgba(91,215,242,.32); color:#d9fbff; font-size:12px}

    /* App view */
    .app-wrap{max-width:1200px;margin:0 auto;padding:10px 16px;height:100%;display:flex;flex-direction:column}
    .app-head{display:flex;align-items:center;justify-content:space-between;margin:6px 0 10px}
    .app-meta{display:flex;align-items:center;gap:10px}
    .app-ic{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:rgba(91,215,242,.16); border:1px solid rgba(91,215,242,.3)}
    .app-title{margin:0;font-size:18px;color:#d8fbff;font-weight:600}
    .app-desc{margin:0;font-size:12px;color:#aee9f7}
    .btn{display:inline-flex;align-items:center;gap:8px;border-radius:12px;padding:8px 12px;background:rgba(91,215,242,.14); border:1px solid rgba(91,215,242,.32); color:#d9fbff; font-size:12px}
    .app-body{position:relative; flex:1; min-height:0;}
    .iframe{position:absolute; inset:0; width:100%; height:100%; border-radius:18px;border:1px solid rgba(91,215,242,.22);background:rgba(5,14,26,.5)}
    .hide{opacity:0;pointer-events:none;transition:opacity .35s ease}
    .show{opacity:1;transition:opacity .35s ease}

    /* Boot */
    .boot{position:fixed;inset:0;display:grid;place-items:center;z-index:50;background:
      radial-gradient(60vmax 60vmax at 50% 40%, rgba(96,165,250,.18), transparent 60%),
      linear-gradient(180deg,#071122,#0a0f1d)}
    .boot .halo{position:absolute; width:44vmin;height:44vmin; border-radius:50%;
      filter:blur(60px); background:radial-gradient(circle, rgba(91,215,242,.28), transparent 60%);
      animation:pulse 4.6s ease-in-out infinite}
    .boot-card{position:relative; display:grid; place-items:center; gap:12px}
    .logo{width:104px;height:104px;border-radius:26px;background:linear-gradient(135deg,rgba(96,165,250,.22),rgba(91,215,242,.12)); border:1px solid rgba(91,215,242,.38); display:grid;place-items:center; box-shadow:0 0 18px rgba(91,215,242,.35) inset}
    .isvg{width:70px;height:70px;filter:drop-shadow(0 6px 14px rgba(96,165,250,.35))}
    .boot h1{margin:0;color:#bff4ff;font-size:30px;letter-spacing:.4px}
    .boot p{margin:2px 0 0;color:#9fe9fb;opacity:.85;font-size:12px}
    .bar{margin-top:12px;height:10px;width:320px;border-radius:999px;background:rgba(91,215,242,.14); border:1px solid rgba(91,215,242,.25); overflow:hidden}
    .bar span{display:block;height:100%;width:34%;background:linear-gradient(90deg,var(--c-cyan),var(--c-sky)); animation:load var(--boot-ms) ease-in-out infinite}
    .skip{margin-top:10px;color:#a2e7f5;font-size:11px;opacity:.85}
    #boot-tips{margin-top:6px;font-size:12px;color:#a7eaff;opacity:.85;text-align:center}
    @keyframes load{0%{transform:translateX(-120%)}100%{transform:translateX(220%)}}
    @keyframes pulse{0%,100%{opacity:.6}50%{opacity:1}}
  </style>
</head>
<body>
  <div class="grid-bg"></div>

  <!-- BOOT -->
  <div id="boot" class="boot show" onclick="window.SInOS && SInOS.skipBoot()" role="button" aria-label="Saltar arranque" title="Toca para saltar">
    <div class="boot-card">
      <div class="halo"></div>
      <div class="logo">
        <svg class="isvg" viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#67e8f9"/>
              <stop offset="100%" stop-color="#60a5fa"/>
            </linearGradient>
          </defs>
          <rect x="8" y="6" width="8" height="44" rx="3" fill="url(#g1)" />
          <path d="M28 12c8-8 20-3 20 6s-7 12-16 14-16 6-16 14 12 14 22 6" stroke="url(#g1)" stroke-width="6" stroke-linecap="round" fill="none"/>
        </svg>
      </div>
      <h1>SInOS</h1>
      <p>SINDICAL INNOVATION OPERATIVE SYSTEM</p>
      <div class="bar"><span></span></div>
      <div id="boot-tips">Inicializando m√≥dulos‚Ä¶</div>
      <div class="skip">Toca para saltar ‚ñ∏</div>
    </div>
  </div>

  <!-- TOP BAR -->
  <div class="topbar" id="topbar">
    <div class="title">
      <div class="mark" aria-hidden>
        <svg viewBox="0 0 56 56" width="18" height="18">
          <defs>
            <linearGradient id="g1a" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#67e8f9" />
              <stop offset="100%" stop-color="#60a5fa" />
            </linearGradient>
          </defs>
          <rect x="8" y="6" width="8" height="44" rx="3" fill="url(#g1a)" />
          <path d="M28 12c8-8 20-3 20 6s-7 12-16 14-16 6-16 14 12 14 22 6" stroke="url(#g1a)" stroke-width="6" stroke-linecap="round" fill="none"/>
        </svg>
      </div>
      <span>SInOS</span>
      <small style="opacity:.7;margin-left:6px">Innovaci√≥n Sindical</small>
    </div>
    <div class="clock" id="clock">--:--:--</div>
  </div>

  <!-- HOME -->
  <main id="home" class="layer show" aria-live="polite">
    <section class="wrap">
      <section class="brand">
        <div>
          <h1>Bienvenido a <span style="color:#93eaff">SInOS</span></h1>
          <p>Sistema Operativo de Innovaci√≥n Sindical. Toca un panel para abrir una app.</p>
        </div>
        <div style="display:flex;gap:8px">
          <div class="badge">Equipo de Innovacion Sindical</div>
        </div>
      </section>
      <section class="tiles" id="tiles"></section>
    </section>
  </main>

  <!-- APP VIEW -->
  <section id="app" class="layer hide" aria-live="polite">
    <div class="app-wrap">
      <div class="app-head">
        <div class="app-meta">
          <div class="app-ic" id="app-ic">üß©</div>
          <div>
            <h2 class="app-title" id="app-title">T√≠tulo</h2>
            <p class="app-desc" id="app-desc">Descripci√≥n</p>
          </div>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn" onclick="SInOS.goHome()">üè† Inicio</button>
          <button class="btn" id="btn-open-new" style="display:none" onclick="SInOS.openExternal()">üîó Abrir en pesta√±a nueva</button>
          <button class="btn" onclick="SInOS.closeApp()">‚úñ Cerrar</button>
        </div>
      </div>
      <div id="app-body" class="app-body">
        <iframe id="app-iframe" class="iframe" title="app" referrerpolicy="no-referrer" style="display:none"></iframe>
        <div id="app-internal" style="position:absolute;inset:0; overflow:auto; padding:8px 0; display:none"></div>
      </div>
    </div>
  </section>

  <!-- DOCK -->
  <div class="dock">
    <div class="dock-inner" id="dock"></div>
  </div>

  <!-- SDK loader para el Page Plugin (Noticias) -->
  <script>
    // Carga el SDK de Facebook UNA sola vez (para Noticias)
    function loadFacebookSDKOnce(locale='es_LA'){
      return new Promise((resolve)=>{
        if (window.FB) return resolve(window.FB);
        if(!document.getElementById('fb-root')){
          const fbroot = document.createElement('div');
          fbroot.id = 'fb-root';
          document.body.appendChild(fbroot);
        }
        const id = 'facebook-jssdk';
        if(document.getElementById(id)) return resolve(window.FB);
        const js = document.createElement('script');
        js.id = id; js.async = true; js.defer = true; js.crossOrigin = 'anonymous';
        js.src = `https://connect.facebook.net/${locale}/sdk.js#xfbml=1&version=v20.0`;
        js.onload = () => resolve(window.FB);
        document.body.appendChild(js);
      });
    }
  </script>

  <script>
    // ===== APPS =====
    const APPS = [
      { id:'trascendencia',
        title:'TrascendencIA Sindical',
        desc:'Asistente IA en nueva pesta√±a.',
        icon:'ü§ñ',
        href:'https://trascendencia-sindical-7t85.onrender.com/',
        quick:true
      },
      { id:'noticias',
        title:'Noticias',
        desc:'Circulares y comunicados en tiempo real.',
        icon:'üì∞',
        type:'internal' // renderer propio con Page Plugin
      },
      { id:'agenda', title:'Agenda', desc:'Calendario de asambleas, guardias y eventos.', icon:'üìÖ', iframe:'about:blank' },
      { id:'denuncias', title:'Denuncias y Reportes', desc:'Genera un escrito formal en PDF, listo para imprimir.', icon:'üõ°Ô∏è',
        iframe:'https://chronosbvrx.github.io/InnovacionSindical/denuncias', quick:true },
      { id:'prestaciones', title:'Prestaciones', desc:'Vacaciones, licencias, est√≠mulos y antig√ºedad.', icon:'üìÑ', iframe:'about:blank' },
      { id:'directorio', title:'Directorio', desc:'Delegados, jur√≠dicos y atenci√≥n a trabajadores.', icon:'üìû', iframe:'about:blank' },
      { id:'miniapp', title:'MiniApp WhatsApp', desc:'Automatizaciones por palabras clave y avisos.', icon:'üí¨', href:'https://wa.me/XXXXXXXXXXX' },
      { id:'ajustes', title:'Ajustes', desc:'Tema, accesibilidad y personalizaci√≥n.', icon:'‚öôÔ∏è', iframe:'about:blank' }
    ];

    // ===== CORE =====
    const SInOS = {
      BOOT_MS: 2200,
      bootEl:null, homeEl:null, appEl:null, appTitle:null, appDesc:null, appIc:null,
      appIframe:null, appInternal:null, btnOpenNew:null, currentApp:null,

      init(){
        try{
          // Nodos
          this.bootEl = document.getElementById('boot');
          this.homeEl = document.getElementById('home');
          this.appEl = document.getElementById('app');
          this.appTitle = document.getElementById('app-title');
          this.appDesc = document.getElementById('app-desc');
          this.appIc = document.getElementById('app-ic');
          this.appIframe = document.getElementById('app-iframe');
          this.appInternal = document.getElementById('app-internal');
          this.btnOpenNew = document.getElementById('btn-open-new');

          // Render
          this.renderTiles();
          this.renderDock();

          // Boot: 1a vez largo
          const FIRST_KEY = 'sinos:bootedOnce';
          const qs = new URLSearchParams(location.search);
          const forceLong = qs.get('boot') === 'long';
          const forceReset = qs.get('boot') === 'reset';
          if(forceReset){ try{ localStorage.removeItem(FIRST_KEY); }catch{} }
          let firstTime=false; try{ firstTime=!localStorage.getItem(FIRST_KEY); }catch{}
          this.BOOT_MS = (forceLong||firstTime) ? 5200 : 2200;
          document.documentElement.style.setProperty('--boot-ms', this.BOOT_MS + 'ms');

          // Tips
          (function(){
            const tips = ['Inicializando m√≥dulos‚Ä¶','Montando apps del sistema‚Ä¶','Verificando integridad de interfaz‚Ä¶','Optimizando desempe√±o para tu dispositivo‚Ä¶'];
            let i=0; setInterval(()=>{ const el=document.getElementById('boot-tips'); if(el){ i=(i+1)%tips.length; el.textContent=tips[i]; } }, 1200);
          })();

          const _hide=this.hideBoot.bind(this);
          this.hideBoot=()=>{ try{ localStorage.setItem(FIRST_KEY,'1'); }catch{}; _hide(); };
          setTimeout(()=>this.hideBoot(), this.BOOT_MS);

          // Reloj
          this.tickClock(); setInterval(()=>this.tickClock(), 1000);

          // Acceso r√°pido
          document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') this.goHome(); });

        }catch(err){ console.error('Init:',err); this.forceShowUI(); }
      },

      tickClock(){ const el=document.getElementById('clock'); if(el) el.textContent=new Date().toLocaleTimeString('es-MX',{hour12:false}); },
      hideBoot(){ this.bootEl?.classList.add('hide'); this.bootEl?.classList.remove('show'); },
      skipBoot(){ this.hideBoot(); },
      forceShowUI(){ this.hideBoot(); this.homeEl?.classList.add('show'); this.homeEl?.classList.remove('hide'); },

      renderTiles(){
        const wrap=document.getElementById('tiles'); wrap.innerHTML='';
        APPS.forEach(a=>{
          const b=document.createElement('button');
          b.className='tile'; b.onclick=()=>this.openApp(a.id);
          b.setAttribute('aria-label',`${a.title}. ${a.desc||''}`);
          b.innerHTML=`
            <div style="display:flex;gap:12px;align-items:center">
              <div class="icon">${a.icon||'üß©'}</div>
              <div><h3>${a.title}</h3><p>${a.desc||''}</p></div>
            </div><div></div>`;
          wrap.appendChild(b);
        });
      },

      renderDock(){
        const el=document.getElementById('dock'); el.innerHTML='';
        APPS.filter(a=>a.quick).slice(0,5).forEach(a=>{
          const btn=document.createElement('button');
          btn.textContent=`${a.icon||'üß©'} ${a.title}`;
          btn.onclick=()=>this.openApp(a.id);
          el.appendChild(btn);
        });
      },

      openApp(id){
        const app=APPS.find(x=>x.id===id); if(!app) return;
        this.currentApp=app;

        // Mostrar capa app
        this.homeEl.classList.add('hide'); this.homeEl.classList.remove('show');
        this.appEl.classList.remove('hide'); this.appEl.classList.add('show');

        // Header
        this.appTitle.textContent=app.title;
        this.appDesc.textContent=app.desc||'';
        this.appIc.textContent=app.icon||'üß©';

        // Reset body
        this.appIframe.style.display='none';
        this.appIframe.src='about:blank';
        this.appInternal.style.display='none';
        this.appInternal.innerHTML='';
        this.btnOpenNew.style.display='none';

        // Routing
        if(app.type==='internal' && app.id==='noticias'){
          this.renderNoticias();
        }else if(app.iframe){
          this.appIframe.style.display='block';
          this.appIframe.src=app.iframe;
        }else if(app.href){
          this.btnOpenNew.style.display='inline-flex'; // abrir en pesta√±a nueva
        }

        if('vibrate' in navigator){ try{ navigator.vibrate(8); }catch{} }
      },

      // ===== Noticias con Page Plugin (f√°cil) =====
      async renderNoticias(){
        this.appInternal.style.display='block';
        const root=this.appInternal;
        root.innerHTML=`
          <div style="padding:10px">
            <div id="fb-news-wrap" style="display:flex;justify-content:center;">
              <div class="fb-page"
                data-href="https://www.facebook.com/profile.php?id=100063446307036"
                data-tabs="timeline"
                data-width="980"
                data-height=""
                data-small-header="false"
                data-adapt-container-width="true"
                data-hide-cover="false"
                data-show-facepile="false">
                <blockquote cite="https://www.facebook.com/profile.php?id=100063446307036" class="fb-xfbml-parse-ignore">
                  <a href="https://www.facebook.com/profile.php?id=100063446307036">Noticias</a>
                </blockquote>
              </div>
            </div>
          </div>
        `;
        const pageDiv=root.querySelector('.fb-page');
        const fit=()=>{
          const max=Math.min(1000, root.clientWidth - 24);
          pageDiv.setAttribute('data-width', String(Math.max(320,max)));
          if(window.FB && FB.XFBML) FB.XFBML.parse(root);
        };
        await loadFacebookSDKOnce('es_LA');
        fit();
        window.addEventListener('resize', ()=>{ clearTimeout(window.__fbFitT); window.__fbFitT=setTimeout(fit,180); });
      },

      openExternal(){ if(this.currentApp?.href){ window.open(this.currentApp.href,'_blank','noopener,noreferrer'); } },
      closeApp(){ this.goHome(); },
      goHome(){
        this.appEl.classList.remove('show'); this.appEl.classList.add('hide');
        this.homeEl.classList.remove('hide'); this.homeEl.classList.add('show');
        this.appIframe.src='about:blank';
      }
    };

    // Evitar rebote en m√≥viles
    document.addEventListener('touchmove', function(e){
      const target = e.target.closest?.('.layer');
      if(!target) e.preventDefault();
    }, {passive:false});

    // Exponer y arrancar
    window.SInOS = SInOS;
    document.addEventListener('DOMContentLoaded', ()=> SInOS.init());
  </script>

  <!-- Paraca√≠das: timeout o error; NO en 'load' -->
  <script>
    (function(){
      function forceHideBoot(){
        var b=document.getElementById('boot');
        if(b){ b.style.transition='opacity .35s ease'; b.style.opacity='0'; b.style.pointerEvents='none'; b.style.zIndex='0'; b.classList.add('hide'); }
        var home=document.getElementById('home'); if(home){ home.classList.add('show'); home.classList.remove('hide'); }
        var tb=document.getElementById('topbar'); if(tb) tb.style.display='flex';
      }
      function scheduleFallback(){
        var base=(window.SInOS && SInOS.BOOT_MS ? SInOS.BOOT_MS : 7000) + 1500;
        setTimeout(forceHideBoot, base);
      }
      if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', scheduleFallback); } else { scheduleFallback(); }
      window.addEventListener('error', forceHideBoot);
      window.addEventListener('unhandledrejection', forceHideBoot);
    })();
  </script>
</body>
</html>
