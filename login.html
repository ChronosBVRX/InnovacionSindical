<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Plataforma Sindical CG ‚Äî Acceso</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<style>
  :root{
    /* ‚úÖ Paleta oficial ‚Äî Plataforma Sindical CG */
    --bg:#1b2e45;          /* body */
    --bg2:#152336;         /* degradado */
    --panel:#2e4f77;       /* cards */
    --ring:rgba(77,161,168,.35); /* bordes/anillos */
    --txt:#f0fdfa;         /* texto principal */
    --muted:#bce9eb;       /* texto secundario */
    --accent:#4da1a8;      /* primary */
    --sky:#7ad1d6;         /* sky */
    --err:#ff7b7b;
  }

  *{box-sizing:border-box}

  html,body{
    height:100%; margin:0; color:var(--txt);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
    background:
      radial-gradient(70vmax 70vmax at 50% 20%, rgba(77,161,168,.18), transparent 60%),
      radial-gradient(60vmax 60vmax at 80% 80%, rgba(122,209,214,.12), transparent 60%),
      linear-gradient(180deg,var(--bg2),var(--bg));
  }

  .wrap{max-width:980px;margin:0 auto;padding:22px}

  .card{
    background:linear-gradient(180deg, rgba(46,79,119,.92), rgba(27,46,69,.92));
    border:1px solid var(--ring);
    border-radius:16px;
    padding:16px;
    box-shadow:0 10px 40px rgba(0,0,0,.45);
    backdrop-filter: blur(6px);
  }

  .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;gap:12px;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:10px;min-width:240px}
  .brand img{
    width:42px;height:42px;border-radius:12px;
    border:1px solid var(--ring);
    background:rgba(21,35,54,.9);
    object-fit:contain;
  }

  h1{margin:0;font-size:18px;color:var(--txt)}
  .muted{color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

  .tabs{display:flex;gap:8px;margin:8px 0 12px;flex-wrap:wrap}
  .tab{
    appearance:none;
    border:1px solid var(--ring);
    background:rgba(77,161,168,.12);
    color:var(--txt);
    border-radius:12px;
    padding:8px 12px;
    cursor:pointer;
  }
  .tab.active{
    background:linear-gradient(90deg,var(--accent),var(--sky));
    border:none;
    color:#0b2230;
    font-weight:700;
  }

  label{display:block;font-size:12px;color:var(--muted);margin:6px 0 4px}

  input,select{
    width:100%;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid var(--ring);
    background:rgba(21,35,54,.85);
    color:var(--txt);
    outline:none;
  }
  input:focus, select:focus{
    border-color: rgba(122,209,214,.65);
    box-shadow: 0 0 0 4px rgba(77,161,168,.18);
  }

  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .grid-1{grid-column:1/-1}
  @media(max-width:760px){ .grid{grid-template-columns:1fr} }

  .btn{
    appearance:none;
    border:1px solid var(--ring);
    background:rgba(77,161,168,.12);
    color:var(--txt);
    border-radius:12px;
    padding:10px 14px;
    font-size:14px;
    cursor:pointer;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
  }
  .btn:hover{filter:brightness(1.05)}
  .btn.primary{
    background:linear-gradient(90deg,var(--accent),var(--sky));
    border:none;
    color:#0b2230;
    font-weight:800;
  }

  .error{color:var(--err);font-size:13px;margin-top:8px}
  .hint{font-size:12px;color:rgba(188,233,235,.92)}

  .link-sm{
    font-size:12px;
    color:var(--muted);
    text-decoration:underline;
    cursor:pointer;
  }
  .link-sm:hover{color:var(--txt)}

  hr.sep{border:none;border-top:1px solid var(--ring)}

  /* üîé Combo autocompletable (Categor√≠a) */
  .combo{ position:relative; }
  .combo-list{
    position:absolute;
    top:calc(100% + 6px);
    left:0; right:0;
    z-index:50;
    background:rgba(21,35,54,.98);
    border:1px solid var(--ring);
    border-radius:12px;
    box-shadow:0 10px 40px rgba(0,0,0,.45);
    max-height:260px;
    overflow:auto;
    padding:6px;
    display:none;
  }
  .combo-item{
    padding:10px 10px;
    border-radius:10px;
    cursor:pointer;
    color:var(--txt);
  }
  .combo-item:hover,
  .combo-item.active{
    background:rgba(77,161,168,.18);
    outline:1px solid rgba(77,161,168,.25);
  }
  .combo-empty{
    padding:10px 10px;
    color:var(--muted);
    font-size:12px;
  }
</style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div class="brand">
          <img src="https://raw.githubusercontent.com/ChronosBVRX/InnovacionSindical/refs/heads/main/Logo%20SNTSS.jpeg" alt="Logo">
          <div>
            <h1>Plataforma Sindical CG</h1>
            <div class="muted">Acceso a miembros</div>
          </div>
        </div>
        <a class="btn" href="https://chronosbvrx.github.io/InnovacionSindical/">‚Üê Volver al inicio</a>
      </div>

      <div class="tabs">
        <button id="tabLogin" class="tab active" type="button">Entrar</button>
        <button id="tabSignup" class="tab" type="button">Crear cuenta</button>
      </div>

      <!-- LOGIN -->
      <form id="fLogin" class="grid" autocomplete="on">
        <div class="grid-1">
          <label for="liEmail">Correo</label>
          <input id="liEmail" type="email" placeholder="tu@correo.com" required>
        </div>
        <div class="grid-1">
          <label for="liPass">Contrase√±a</label>
          <input id="liPass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>
        <div class="grid-1 row">
          <button class="btn primary" type="submit">Entrar</button>
          <span class="hint">¬øNuevo? cambia a ‚ÄúCrear cuenta‚Äù.</span>
        </div>

        <div class="grid-1">
          <span id="forgotPass" class="link-sm">¬øOlvidaste tu contrase√±a?</span>
        </div>

        <div id="liErr" class="grid-1 error" role="alert"></div>
      </form>

      <!-- SIGNUP -->
      <form id="fSignup" class="grid" style="display:none" autocomplete="on">
        <div>
          <label for="suName">Nombre para mostrar</label>
          <input id="suName" placeholder="Ej. Ana G√≥mez" required>
        </div>

        <div>
          <label for="suPhone">Tel√©fono</label>
          <input id="suPhone" type="tel" inputmode="tel" placeholder="10 d√≠gitos" pattern="^[0-9+\-\s()]{7,20}$" required>
        </div>

        <div>
          <label for="suBirth">Fecha de cumplea√±os</label>
          <input id="suBirth" type="date" required>
        </div>

        <!-- ‚úÖ CATEGOR√çA CON AUTOCOMPLETADO -->
        <div class="grid-1">
          <label for="suCategoria">Categor√≠a</label>

          <div class="combo">
            <input id="suCategoria"
                   placeholder="Escribe tu categor√≠a (ej. Enfermera, T√©cnico, M√©dico...)"
                   autocomplete="off"
                   required
                   role="combobox"
                   aria-autocomplete="list"
                   aria-expanded="false"
                   aria-controls="catList" />

            <div id="catList" class="combo-list" role="listbox" aria-label="Sugerencias de categor√≠a"></div>
          </div>

          <div class="hint">Tip: escribe 2‚Äì3 letras para ver opciones.</div>
        </div>

        <!-- üîµ ADSCRIPCI√ìN SELECT -->
        <div class="grid-1">
          <label for="suAdscripcion">Adscripci√≥n</label>
          <select id="suAdscripcion" required>
            <option value="">Selecciona tu adscripci√≥n</option>

            <optgroup label="R√©gimen Ordinario">
              <option>HGR No. 1 Charo (Morelia)</option>
            </optgroup>

            <optgroup label="Hospitales Generales de Zona (HGZ) y Subzona (HGSZ)">
              <option>HGZ No. 83 Morelia (Camelinas)</option>
              <option>HGZ No. 8 Uruapan</option>
              <option>HGZ No. 4 Zamora</option>
              <option>HGZ No. 12 L√°zaro C√°rdenas</option>
              <option>HGZ No. 2 Zacapu</option>
              <option>HGSZ No. 7 La Piedad</option>
              <option>HGSZ No. 9 Apatzing√°n</option>
              <option>HGSZ No. 17 Los Reyes</option>
              <option>HGSZ No. 24 Pedernales</option>
            </optgroup>

            <optgroup label="Unidades de Medicina Familiar (UMF)">
              <option>UMF No. 3 Quiroga</option>
              <option>UMF No. 6 Jiquilpan</option>
              <option>UMF No. 10 Jungapeo</option>
              <option>UMF No. 11 Nueva Italia</option>
              <option>UMF No. 13 Cotija</option>
              <option>UMF No. 18 Zit√°cuaro</option>
              <option>UMF No. 19 Ciudad Hidalgo</option>
              <option>UMF No. 20 P√°tzcuaro</option>
              <option>UMF No. 21 Jacona</option>
              <option>UMF No. 23 Infiernillo</option>
              <option>UMF No. 25 Puruar√°n</option>
              <option>UMF No. 26 Taretan</option>
              <option>UMF No. 28 Santa Clara</option>
              <option>UMF No. 37 Mineral de Angangueo</option>
              <option>UMF No. 40 Coalcom√°n</option>
              <option>UMF No. 42 Cuitzeo</option>
              <option>UMF No. 43 Churumuco</option>
              <option>UMF No. 46 La Huacana</option>
              <option>UMF No. 48 Huetamo</option>
              <option>UMF No. 52 Nuevo Urecho</option>
              <option>UMF No. 54 Pur√©pero</option>
              <option>UMF No. 64 Puru√°ndiro</option>
              <option>UMF No. 65 Villa Madero</option>
              <option>UMF No. 66 Villamar</option>
              <option>UMF No. 70 Zinap√©cuaro</option>
              <option>UMF No. 71 Morelia</option>
              <option>UMF No. 74 Tac√°mbaro</option>
              <option>UMF No. 75 Morelia (Camelinas)</option>
              <option>UMF No. 76 Uruapan</option>
              <option>UMF No. 77 La Piedad</option>
              <option>UMF No. 78 L√°zaro C√°rdenas</option>
              <option>UMF No. 80 Morelia (Centro)</option>
              <option>UMF No. 81 Uruapan</option>
              <option>UMF No. 82 Zamora</option>
              <option>UMF No. 84 Morelia (Tac√≠cuaro)</option>
              <option>UMF No. 85 Tar√≠mbaro</option>
            </optgroup>

            <optgroup label="IMSS-Bienestar ‚Äî Hospitales Rurales (HR)">
              <option>HR No. 30 Ario de Rosales</option>
              <option>HR No. 31 Huetamo</option>
              <option>HR No. 33 Paracho</option>
              <option>HR No. 35 Buenavista Tomatl√°n</option>
              <option>HR No. 50 Tuxpan</option>
              <option>HR No. 51 Villamar</option>
              <option>HR No. 59 Coalcom√°n</option>
            </optgroup>

          </select>
        </div>

        <div class="grid-1"><hr class="sep"></div>

        <div>
          <label for="suEmail">Correo</label>
          <input id="suEmail" type="email" placeholder="tu@correo.com" required>
        </div>

        <div>
          <label for="suPass">Contrase√±a</label>
          <input id="suPass" type="password" minlength="6" placeholder="M√≠nimo 6 caracteres" required>
        </div>

        <div class="grid-1 row">
          <button class="btn primary" type="submit">Crear cuenta</button>
          <span class="hint">Te enviaremos un correo para confirmar.</span>
        </div>

        <div id="suErr" class="grid-1 error" role="alert"></div>
      </form>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
  (()=>{

    // ‚úÖ Supabase
    const SUPABASE_URL = "https://axsncdwshdvsysrpikwj.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF4c25jZHdzaGR2c3lzcnBpa3dqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAyMjkwMjQsImV4cCI6MjA3NTgwNTAyNH0.oapcH219puVjaR2DcG7dX51uhwVn530L1hhz8ASv7qs";

    const REDIRECT_AFTER_LOGIN = "miembros.html";
    const RESET_PASSWORD_REDIRECT = "https://chronosbvrx.github.io/InnovacionSindical/reset-password.html";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true }
    });

    const $ = s => document.querySelector(s);
    const fLogin = $('#fLogin'), fSignup = $('#fSignup');
    const tabLogin = $('#tabLogin'), tabSignup = $('#tabSignup');
    const liErr = $('#liErr'), suErr = $('#suErr');
    const forgotPass = $('#forgotPass');

    function showLogin(){
      fLogin.style.display='grid';
      fSignup.style.display='none';
      tabLogin.classList.add('active');
      tabSignup.classList.remove('active');
      liErr.textContent='';
      suErr.textContent='';
    }

    function showSignup(){
      fLogin.style.display='none';
      fSignup.style.display='grid';
      tabSignup.classList.add('active');
      tabLogin.classList.remove('active');
      liErr.textContent='';
      suErr.textContent='';
    }

    tabLogin.addEventListener('click', showLogin);
    tabSignup.addEventListener('click', showSignup);

    supabase.auth.getSession().then(({data})=>{
      if (data?.session) location.href = REDIRECT_AFTER_LOGIN;
    });

    /* =========================
       ‚úÖ AUTOCOMPLETADO CATEGOR√çA
       ========================= */
    const CATEGORIAS = [
      "Pasante de Abogado","Abogado","Auxiliar T√©cnico de Actuariado Social","Oficial T√©cnico de Actuariado Social",
      "T√©cnico de Actuariado Social","Actuario Social Matem√°tico","Auxiliar de Almac√©n","Oficial de Almac√©n",
      "Coordinador de Almac√©n","Jefe de Grupo de Almac√©n","Especialista de Almac√©n","Arquitecto","Asistente M√©dica",
      "Coordinadora de Asistentes M√©dicas","Ayudante de Autopsia","Auxiliar de Servicios Administrativos","T√©cnico de Bibliotecas",
      "Asistente de Bibliotecario","Bibliotecario","Bi√≥logo","Ayudante de Cajero B","Ayudante de Cajero A","Cajero D","Cajero C",
      "Cajero B","Cajero A","Camillero de Unidades Hospitalarias","Auxiliar de Administraci√≥n de Centro Vacacional",
      "Auxiliar de Atenci√≥n M√©dica de Centro Vacacional","Auxiliar de Hospedaje de Centro Vacacional","Auxiliar de Operaci√≥n Contable de Centro Vacacional",
      "Lavandero en Centros Vacacionales","Operador de Seguridad en Albercas de Centro Vacacional","Operador de Servicios Internos de Centro Vacacional",
      "Operador de Veh√≠culos de Centro Vacacional","Planchador en Centros Vacacionales","Vigilante de Centros Vacacionales","Cirujano M√°xilo Facial",
      "Citotecn√≥logo","T√©cnico Polivalente","T√©cnico Electricista","T√©cnico Electr√≥nico","T√©cnico Mec√°nico","T√©cnico Plomero",
      "T√©cnico A en Aire Acondicionado y Refrigeraci√≥n","T√©cnico A en Equipos M√©dicos","T√©cnico A en Fluidos y Energ√©ticos","T√©cnico A en Plantas de Lavado",
      "T√©cnico A en Telecomunicaciones","T√©cnico B en Equipos M√©dicos","T√©cnico B en Fluidos y Energ√©ticos","T√©cnico B en Plantas de Lavado",
      "T√©cnico B en Telecomunicaciones","T√©cnico en Equipos Reciprocantes","T√©cnico en Electr√≥nica M√©dica y Laboratorio","T√©cnico C en Fluidos y Energ√©ticos",
      "T√©cnico C en Plantas de Lavado","T√©cnico C en Telecomunicaciones","T√©cnico en Mec√°nica, Fluidos y Especialidades","T√©cnico en Equipos de Absorci√≥n",
      "T√©cnico en Equipos Helicoidal","T√©cnico en Equipos de Rayos X","T√©cnico en Equipos Turbocentr√≠fugo","Especialista en Equipos de Especialidades",
      "Especialista en Equipos de Laboratorio","Especialista en Equipos de Mec√°nica y Fluidos","Especialista en Equipos de Aire Acondicionado y Refrigeraci√≥n",
      "Especialista en Plantas de Lavado","Especialista en Equipos de Electr√≥nica M√©dica","Especialista en Equipos de Rayos X","Especialista en Fluidos y Energ√©ticos",
      "Contador","Contador Auditor","Cuidador de Animales","Dibujante de Construcci√≥n","Dibujante de Estad√≠stica y Publicidad C","Dibujante de Estad√≠stica y Publicidad B",
      "Dibujante de Estad√≠stica y Publicidad A","Dibujante de Ingenier√≠a y Arquitectura","Pasante de Economista","Economista","Educadora","Electrocardiografista",
      "Elevadorista","Auxiliar de Enfermer√≠a General","Auxiliar de Enfermer√≠a en Salud P√∫blica","Enfermera General","Enfermera General Cl√≠nica","Enfermera Especialista",
      "Enfermera Jefe de Piso","Estomat√≥logo","Auxiliar de Farmacia","Ayudante de Farmacia","Oficial de Farmacia","Coordinador de Farmacia","Fonoaudi√≥logo","Guardavidas",
      "Oficial de Puericultura","T√©cnico de Puericultura","Heliografista","Histotecn√≥logo","Pasante de Ingeniero","Ingeniero","Inhaloterapeuta","Auxiliar de Servicios de Intendencia",
      "Ayudante de Servicios de Intendencia","Oficial de Servicios de Intendencia","Intendente","Auxiliar de Laboratorio","Laboratorista","Operador de Servicios de Lavander√≠a",
      "Oficial de Servicios de Lavander√≠a","Auxiliar de Limpieza e Higiene en Unidades M√©dicas y No M√©dicas","Ayudante de Limpieza e Higiene en Unidades M√©dicas y No M√©dicas",
      "Machetero","Masajista","M√©dico General","M√©dico No Familiar","M√©dico Familiar","T√©cnico de Microfotograf√≠a","Multilitista","Nutricionista Dietista",
      "Especialista en Nutrici√≥n y Diet√©tica","Nutri√≥logo Cl√≠nico Especializado","Operador de Equipo de Intercomunicaci√≥n Neum√°tica","Operador de M√°quinas de Revelado Autom√°tico",
      "Optometrista","Orientador","Orientador de Actividades Familiares","Orientador de Actividades Art√≠sticas (Cl√°sica y Moderna)","Orientador de Actividades Art√≠sticas (Danza Regional)",
      "Orientador de Actividades Art√≠sticas (Maestro de M√∫sica)","Orientador de Actividades Art√≠sticas (Arte Dram√°tico)","Orientador de Educaci√≥n F√≠sica","Orientador de Iniciaci√≥n Cultural",
      "Orientador T√©cnico M√©dico","Auxiliar de Orientador T√©cnico M√©dico","Ortopedista","Partera","Jefe de Parteras","Peluquero","Pianista","Auxiliar de Administraci√≥n en Unidad M√©dica",
      "Auxiliar de Enfermer√≠a en Unidad M√©dica","Auxiliar de Limpieza y Cocina en Unidad M√©dica","Auxiliar de Servicios Generales en Unidad M√©dica","Profesor de Educaci√≥n F√≠sica A",
      "Profesor de Educaci√≥n F√≠sica B","Profesor de Educaci√≥n F√≠sica C","Promotor de Estomatolog√≠a","Promotor de Salud Comunitaria","Psic√≥logo","Psic√≥logo Cl√≠nico","Psic√≥metra","Qu√≠mico Cl√≠nico",
      "Preparador de Mezclas","Qu√≠mico Cl√≠nico Jefe de Secci√≥n","T√©cnico Radi√≥logo","Radioterapeuta","Redactor B","Manejador de Alimentos","Cocinero T√©cnico 2","Cocinero T√©cnico 1",
      "Soci√≥logo","Auxiliar de Soporte T√©cnico en Inform√°tica","Oficial de Soporte T√©cnico en Inform√°tica","Coordinador de Soporte T√©cnico en Inform√°tica","T√©cnico en Anestesia",
      "T√©cnico en el Manejo de Aparatos de Electrodiagn√≥stico","T√©cnico en Medicina Nuclear","Auxiliar de T√©cnico en Servicios de Dietolog√≠a","Operador Telef√≥nico A","Operador Telef√≥nico B",
      "Operador Telef√≥nico C","Coordinador de Operadores Telef√≥nicos","Terapista F√≠sico","Terapista Ocupacional","Operador General en Tiendas","Jefe de L√≠nea en Tiendas","Trabajadora Social",
      "Trabajador Social Cl√≠nico","Auxiliar de Trabajo Social","Chofer","Motociclista","Controlador de Veh√≠culos","Enfermera para el Traslado de Pacientes de Urgencia",
      "Enfermera para el Traslado de Pacientes de Terapia Intensiva","T√©cnico Operador de Transporte de Pacientes de Urgencia","T√©cnico Operador de Transporte de Pacientes de Terapia Intensiva",
      "M√©dico para el Traslado de Pacientes de Urgencia","M√©dico para el Traslado de Pacientes de Terapia Intensiva","Auxiliar de Administraci√≥n en Unidad M√©dica de Esquema Modificado y Campo",
      "Auxiliar de Atenci√≥n M√©dica en Unidad M√©dica de Esquema Modificado y Campo","Auxiliar de Laboratorio en Unidad M√©dica de Esquema Modificado y Campo","Auxiliar de Servicios Generales en Unidad M√©dica de Esquema Modificado y Campo",
      "Estomat√≥logo en Unidad M√©dica de Esquema Modificado y Campo","Operador de Servicios de Radiodiagn√≥stico en Unidad M√©dica de Esquema Modificado y Campo","Auxiliar de Administraci√≥n en Unidad M√©dica de Campo",
      "Auxiliar de √Årea M√©dica en Unidad M√©dica de Campo","Auxiliar de Servicios Generales en Unidad M√©dica de Campo","Estomat√≥logo en Unidad M√©dica de Campo","Operador de Mantenimiento en Unidad M√©dica de Campo",
      "Operador de Servicios Auxiliares en Unidad M√©dica de Campo (Laboratorio)","Operador de Servicios Auxiliares en Unidad M√©dica de Campo (Radiodiagn√≥stico)","Mensajero","Auxiliar Universal de Oficinas",
      "Oficial de Tesorer√≠a","Coordinador de Tesorer√≠a","Jefe de Grupo de Tesorer√≠a","Especialista de Tesorer√≠a","Oficial de Servicios T√©cnicos","Coordinador de Servicios T√©cnicos",
      "Jefe de Grupo de Servicios T√©cnicos","Especialista de Servicios T√©cnicos","Oficial de Servicios Administrativos","Coordinador de Servicios Administrativos","Jefe de Grupo de Servicios Administrativos",
      "Especialista de Servicios Administrativos","Oficial de Personal","Coordinador de Personal","Jefe de Grupo de Personal","Especialista de Personal","Oficial de Estad√≠stica","Coordinador de Estad√≠stica",
      "Jefe de Grupo de Estad√≠stica","Especialista de Estad√≠stica","Oficial de Procesamiento de Datos","Coordinador de Procesamiento de Datos","Jefe de Grupo de Procesamiento de Datos",
      "Especialista de Procesamiento de Datos","Oficial de Contabilidad","Coordinador de Contabilidad","Especialista de Contabilidad","Jefe de Oficina A","Jefe T√©cnico de Cobranzas y Adeudos",
      "Jefe de Grupo de Servicios de Personal","Camillero en Veh√≠culos de Servicios Ordinarios y Programados","Operador de Veh√≠culos de Servicios Ordinarios y Programados","Operador de Ambulancias",
      "Controlador de Veh√≠culos de Servicios Ordinarios y Programados","Auxiliar de Velatorio","Operador de Velatorio","Ayudante de Embalsamamiento","Veterinario","Yesista","M√©dico Residente R1","M√©dico Residente R2",
      "M√©dico Residente R3","M√©dico Residente R4","M√©dico Residente R5","M√©dico Residente R6","M√©dico Residente R7","M√©dico Residente R8"
    ];

    CATEGORIAS.sort((a,b)=>a.localeCompare(b,'es',{sensitivity:'base'}));

    const catInput = document.getElementById('suCategoria');
    const catList  = document.getElementById('catList');

    let catOpen = false;
    let catActiveIndex = -1;
    let catResults = [];
    let categoriaSeleccionada = false;

    const norm = (s)=> (s||"")
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g,"");

    function closeCat(){
      catList.style.display = 'none';
      catInput.setAttribute('aria-expanded','false');
      catOpen = false;
      catActiveIndex = -1;
    }

    function openCat(){
      if (!catResults.length){
        closeCat();
        return;
      }
      catList.style.display = 'block';
      catInput.setAttribute('aria-expanded','true');
      catOpen = true;
    }

    function highlightCat(idx){
      const nodes = [...catList.querySelectorAll('.combo-item')];
      nodes.forEach(n=>n.classList.remove('active'));
      catActiveIndex = idx;

      if (idx >= 0 && nodes[idx]){
        nodes[idx].classList.add('active');
        nodes[idx].scrollIntoView({block:'nearest'});
      }
    }

    function selectCat(idx){
      const chosen = catResults[idx];
      if (!chosen) return;
      catInput.value = chosen;
      categoriaSeleccionada = true; // ‚úÖ SOLO aqu√≠ se vuelve v√°lida
      closeCat();
    }

    function renderCat(items){
      catList.innerHTML = '';

      if (!items.length){
        catList.innerHTML = `<div class="combo-empty">Sin coincidencias</div>`;
        openCat();
        return;
      }

      items.slice(0, 30).forEach((txt, idx)=>{
        const div = document.createElement('div');
        div.className = 'combo-item';
        div.textContent = txt;
        div.setAttribute('role','option');
        div.addEventListener('mousedown', (e)=>{
          e.preventDefault(); // evita blur antes de seleccionar
          selectCat(idx);
        });
        catList.appendChild(div);
      });

      openCat();
      highlightCat(-1);
    }

    function filterCat(){
      const q = norm(catInput.value.trim());
      if (q.length < 2){
        catResults = [];
        closeCat();
        return;
      }
      catResults = CATEGORIAS.filter(c => norm(c).includes(q));
      renderCat(catResults);
    }

    catInput.addEventListener('input', filterCat);
    catInput.addEventListener('input', ()=>{ categoriaSeleccionada = false; }); // escribir NO cuenta como seleccionar
    catInput.addEventListener('focus', filterCat);
    catInput.addEventListener('blur', ()=>{
      if (!categoriaSeleccionada) catInput.value = '';
      setTimeout(closeCat, 120);
    });

    catInput.addEventListener('keydown', (e)=>{
      const nodes = [...catList.querySelectorAll('.combo-item')];

      if (!catOpen && (e.key === 'ArrowDown' || e.key === 'ArrowUp')){
        filterCat();
        return;
      }
      if (!catOpen) return;

      if (e.key === 'ArrowDown'){
        e.preventDefault();
        const next = Math.min(nodes.length - 1, catActiveIndex + 1);
        highlightCat(next);
      } else if (e.key === 'ArrowUp'){
        e.preventDefault();
        const prev = Math.max(0, catActiveIndex - 1);
        highlightCat(prev);
      } else if (e.key === 'Enter'){
        if (catActiveIndex >= 0){
          e.preventDefault();
          selectCat(catActiveIndex);
        }
      } else if (e.key === 'Escape'){
        closeCat();
      }
    });

    document.addEventListener('click', (e)=>{
      if (!catList.contains(e.target) && e.target !== catInput) closeCat();
    });

    /* LOGIN */
    fLogin.addEventListener('submit', async (e)=>{
      e.preventDefault();
      liErr.textContent = '';
      const email = $('#liEmail').value.trim();
      const password = $('#liPass').value;

      const { error } = await supabase.auth.signInWithPassword({ email, password });
      if (error){
        liErr.textContent = 'Error: ' + (error.message || 'No se pudo iniciar sesi√≥n');
        return;
      }
      location.href = REDIRECT_AFTER_LOGIN;
    });

    /* OLVID√â CONTRASE√ëA */
    forgotPass.addEventListener('click', async ()=>{
      liErr.textContent = '';
      let email = $('#liEmail').value.trim();

      if (!email){
        email = prompt("Escribe el correo con el que te registraste:");
        if (!email) return;
        email = email.trim();
      }

      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: RESET_PASSWORD_REDIRECT
      });

      if (error){
        liErr.textContent = "No se pudo enviar el correo: " + (error.message || "");
        return;
      }

      alert("Te enviamos un correo con instrucciones para restablecer tu contrase√±a.");
    });

    /* SIGNUP */
    fSignup.addEventListener('submit', async (e)=>{
      e.preventDefault();
      suErr.textContent = '';

      const display_name = $('#suName').value.trim();
      const phone        = $('#suPhone').value.trim();
      const birthdate    = $('#suBirth').value;
      const categoria    = $('#suCategoria').value.trim();
      const adscripcion  = $('#suAdscripcion').value;

      const email        = $('#suEmail').value.trim();
      const password     = $('#suPass').value;

      if (!display_name || !phone || !birthdate || !categoria || !adscripcion){
        suErr.textContent = 'Completa todos los campos del perfil.';
        return;
      }

      // ‚úÖ Validaci√≥n: obliga a elegir de la lista
      if (!categoriaSeleccionada){
        suErr.textContent = "Debes seleccionar una categor√≠a de la lista desplegable.";
        catInput.focus();
        return;
      }

      const { error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: { display_name, phone, birthdate, categoria, adscripcion }
        }
      });

      if (error){
        suErr.textContent = 'Error: ' + (error.message || 'No se pudo crear la cuenta');
        return;
      }

      alert('¬°Cuenta creada! Revisa tu correo para confirmar la direcci√≥n. Luego inicia sesi√≥n.');
      showLogin();
      $('#liEmail').value = email;
    });

  })();
  </script>
</body>
</html>
